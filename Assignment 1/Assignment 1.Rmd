---
title: "Assignment 1"
author: "Rodríguez González, Álvaro"
date: "10/6/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Preprocesamiento: Carga datos y librerias

Cargamos las librerias a usar:

```{r}
library(tidyverse)
library(GGally)
library(MLTools)
library(caret)
library(ROCR)
```

Cargamos los datos:

```{r}
datos <- read.table("./data/Diabetes.csv", sep = ";", header = TRUE)
```




# Análisis Exploratorio


Resumen general del datasets
```{r}
str(datos)
summary(datos)
```

Realizamos algunos cambios en el dataset
```{r}
datos <- datos %>%
  mutate(DIABETES = ifelse(DIABETES == 1, "Si", "No"))
datos <- datos %>%
  mutate(DIABETES = as.factor(DIABETES))
```
Vemos que no hay datos nulos y por lo tanto trabajaremos con todas las filas que hemos cargado



Resumen de pacientes con diabetes 
```{r}
datos %>%
  count(DIABETES) %>%
  mutate(frecuenciaAbosulta = n, frecuenciaRelativa = frecuenciaAbosulta/sum(n), n = NULL)
```



```{r}
ggplot(datos) +
  geom_boxplot(aes(AGE))
```

Tabla de frecuencias absolutas de pregnant
```{r}
table(datos$PREGNANT)
```

Histograma de Glucose
```{r}
ggplot(datos, aes(x = GLUCOSE)) + 
  geom_histogram(aes(y = stat(density)), fill = "red", color = "black", bins = 20, alpha = 0.8) + 
  geom_density(color = "green", size = 1.5)
```


Analizamos la varibale Glucosa
```{r}
ggplot(datos) + 
  geom_boxplot(aes(y = GLUCOSE))
```


```{r}
ggplot(datos, aes(x = BLOODPRESS)) + 
  geom_histogram(aes(y = stat(density)), color = "black", fill = "red", bins = 20, alpha = 0.8) + 
  geom_density(aes(BLOODPRESS), color = "green", size = 1.5)
boxplot(datos$BLOODPRESS)
```


Analizamos la variable SKINTHICKNESS
```{r}
ggplot(datos, aes(x = SKINTHICKNESS)) + 
  geom_histogram(aes(y = stat(density)), color = "black", fill = "red", bins = 20, alpha = 0.8) +
  geom_density(aes(SKINTHICKNESS), color = "green", size = 1.5)
boxplot(datos$SKINTHICKNESS)
```


Vemos la variable INSULIN
```{r}
ggplot(datos, aes(x = INSULIN)) + 
  geom_histogram(aes(y = stat(density)), color = "black", fill = "red", bins = 20, alpha = 0.8) +
  geom_density(aes(INSULIN), size = 1.5, color = "green")
boxplot(datos$INSULIN)
```


Vemos la variable BODYMASSINDEX
```{r}
ggplot(datos, aes(x = BODYMASSINDEX)) + 
  geom_histogram(aes(y = stat(density)), color = "black", fill = "red", bins = 20, alpha = 0.8) +
  geom_density(aes(BODYMASSINDEX), color = "green", size = 1.5)
```


¿Esto es lo mismo que lo de arriba, no?
```{r}
datos_BMI <- datos %>%
  select(BODYMASSINDEX) %>%
  filter(BODYMASSINDEX > 1) %>%
  arrange(desc(BODYMASSINDEX))


# Miro normalidad de los datos 

ggplot(datos_BMI, aes(x = BODYMASSINDEX)) + 
  geom_histogram(aes(y = stat(density)),color = "black", fill = "red", alpha = 0.6) + 
  geom_density(col = "blue")



```
Analizamos la por último la variable PEDIGREEFUNC
```{r}
ggplot(datos) + 
  geom_histogram(aes(x = PEDIGREEFUNC, y = stat(density)), color = "black", fill = "red", bins = 20, alpha = 0.8) +
  geom_density(aes(PEDIGREEFUNC), color = "green", size = 1.5)
boxplot(datos$PEDIGREEFUNC)
```




# Identification and fitting process of classification models

Dividimos el cnjunto de datos en training y en test . Creamos un conjunto partido de 80% entreanmienot y 20% test.

```{r}

ggpairs(datos,aes(color = DIABETES, alpha = 0.3))
PlotDataframe(fdata = datos, 
              output.name = "DIABETES")


```


```{r}
trainIndex <- createDataPartition(datos$DIABETES,      #output variable. createDataPartition creates proportional partitions
                                  p = 0.8,      #split probability for training
                                  list = FALSE, #Avoid output as a list
                                  times = 1)    #only one partition
fTR <- datos[trainIndex,]
fTS <- datos[-trainIndex,]
fTR_eval <- fTR
fTS_eval <- fTS

```



```{r}
ctrl <- trainControl(method = "cv",                        #k-fold cross-validation
                     number = 10,                          #Number of folds
                     summaryFunction = defaultSummary,     #Performance summary for comparing models in hold-out samples.
                     classProbs = TRUE) 
```



Empezamos con la regresión logística

```{r}
LogReg.fit <- train( fTR[, c("PREGNANT", "GLUCOSE", "BLOODPRESS", "SKINTHICKNESS", "INSULIN", "BODYMASSINDEX", "AGE")], 
                       y = fTR$DIABETES,
                       method = "glm",
                       metric = "ROC",
                       trControl = ctrl)
```








